---
title: "Git 流程管理"
date: 2020-11-03T06:11:09+08:00
draft: true
---

## Gitflow
GitFlow 是最早诞生并得到广泛应用的一种版本管理工作流程

常用的分支方式:
- master 对外发布版本,当需要发布版本的时候打 tag 标记

    只有稳定的发布版本即(release)和紧急发布版本(hotfix)才会合并到 master

- develop 日常开发版本,里面是最全最新的代码

    各种 feature 分支开发完成后,先合并到 develop 分支中测试.

- release 稳定发布的版本,对应多个 feature
    
    仅用于版本发布,管理 feature , feature 在 develop 测试通过后合并到 release.
    该 release 所有对应 feature 都测试通过后,合并到 master ,然后 feature，release 删除.

- feature 功能分支

    从release切出，根据需求定义 feature 分支,开发完合并到 develop 测试,测试成功后合并到 release ，并删除feature。

- hotfix 紧急修复分支

    从 master 切出,开发完成后合并到 develop 测试,测试通过后合并到 master

    
该模型中存在两种长期分支: master 和 develop , feature 分支合并到 release 分支后可以删除掉,release 合并到 master 分支后可以删除掉.

master 管理 release ， release 管理 feature.

**管理原则**
- feature 分支的开发粒度要足够小，关联代码少，只需一人短时间便可开发完成

### 业务场景
结合业务场景，让我们更好的理解 gitflow 流程分支适用性。
让我们来假设一个场景，我们需要开发一个博客系统名为 kmjuq-blog(不好意思不要脸了).
产品是慢慢迭代的，因此我们给我们的 blog 系统一个迭代周期，并给每一个功能定义一个版本号（这个版本号的定义也有一些规范，这里就不细说了，具体的版本号和分支对应关系有管理方法，这里也不细说了。）

1. 基础模块（1.0）
    - 用户登录模块（1.1）
    - 博客web编辑模块（1.2）
    - 博客管理模块（1.3）
    
一个在线博客系统至少有这三个模块，但这三部分是基础功能，很难获取长期稳定的收益，于是我们引进商城及其相关功能，比如主题模块(博客页面样式模版)，扩大用户文件（图片、附件、视频）存储空间。

2. 商城模块（2.0）
    - 主题模块（2.1）
    - 用户存储空间模块（2.2）

商城模块试运营了一段时间，发现收益还行。从一个简单的系统成为了用户博客的平台。（大家都喜欢这里）
想进一步通过用户和博客平台互动，增加用户粘性，同时扩大用户和平台收益。

3. 商城优化模块（3.0）
    - 主题模块支持用户自定义并在商城售出获取货币，进行商品兑换，利用抽成增加收益（3.1）
    - 存储空间可以用货币兑换（3.2）
    - 使用现实物件用货币兑换，可以弄周边（3.3）

博客流量多了，收益不满足了，想要另外增加一笔收入，给用户给平台都带来更多的收益。

4. 广告模块（4.0）
    - 文章页面广告，用户可以选择是否开启广告，广告收入可以分成给用户（4.1）

5. 基础模块优化(5.0)
    - 增加博客首页，给用户的公开博客分类引流（5.1）
    - web编辑模块附件在线预览（5.2）

值得注意的是，这里的开发粒度特别大，模块划分不合理，正常肯定不是这样我们，正常来说，我们还得进一步划分（粒度越小，项目交付风险越低）。比如说：
- 用户登录模块
    - 权限校验
    - 用户注册登录
    - 第三方注册登录集成

好了，基本的需求我们已经确定了，剩下只要确定一下路径依赖，就可以划分分支了。
**路径依赖**：
- 基础模块 -> 商城模块 -> 商城优化模块
- 基础模块 -> 基础模块优化
- 商城模块 -> 广告模块

首先我们完成我们的第一个开发迭代，完成**基础模块**。
然后我们我们完成第二个开发迭代，完成**商城模块**，**基础模块优化**.

**划分分支步骤**：
1. 创建一个 master 分支和 develop 分支
2. 从 master 切出 release-1.0
3. 从 releas-1.0 切出 feature-1.1、feature-1.2、feature-1.3
4. feature-1.1、feature-1.2、feature-1.3 分别开发完成后合并到 develop
5. 如果测试全部通过，将所有 feature 合并到 release-1.0，如果没有，则继续在各自的 feature 修改BUG
6. 将 release-1.0 合并到 master 分支，然后打 tag 标记 master-1.0，删除 release-1.0
7. 发布 master-1.0

- 

1. 切换到 master-1.0，从 master-1.0 切出 release-2.0，release-4.0
2. 从 release-2.0 切出 feature-2.1、feature-2.2
3. 从 release-4.0 切出 feature-4.1
4. feature-2.1、feature-2.2 分别开发完成后合并到 develop
5. feature-4.1 开发完成后合并到 develop
6. 如果测试全部通过，将 feature-2.1、feature-2.2 合并到 release-2.0，feature-4.1 合并到 develop
7. 将 release-2.0 合并到 master 分支，然后打 tag 标记 master-2.0，删除 release-2.0
8. 将 release-4.0 合并到 master 分支，然后打 tag 标记 master-4.0，删除 release-4.0
9. 发布 master-4.0

再次说明一下，版本号很不规范，具体的版本号可以看其他文章说明。
大体的使用就是这样了，当然这里没有说明 hotfix ，不过知道其他分支的操作形式基本就知道 hotfix 的操作规范了。
